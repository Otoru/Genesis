<include>
  <context name="public">
    <!-- Prevent loops -->
    <extension name="unloop">
      <condition field="${unroll_loops}" expression="^true$"/>
      <condition field="${sip_looped_call}" expression="^true$">
        <action application="deflect" data="${destination_number}"/>
      </condition>
    </extension>

    <!-- Tag outside calls -->
    <extension name="outside_call" continue="true">
      <condition>
        <action application="set" data="outside_call=true"/>
      </condition>
    </extension>

    <!-- Transfer to default context (authenticated users) -->
    <!-- Routes calls to users 1000-1019 to default context for click2call support -->
    <extension name="public_extensions">
      <condition field="destination_number" expression="^(10[01][0-9])$">
        <action application="transfer" data="$1 XML default"/>
      </condition>
    </extension>

    <!-- Outbound socket test extension -->
    <extension name="outbound_socket_test">
      <condition field="destination_number" expression="^(9999)$">
        <action application="socket" data="host.docker.internal:9696 async full"/>
      </condition>
    </extension>
  </context>
</include>
